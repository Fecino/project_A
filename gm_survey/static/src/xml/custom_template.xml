<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <!-- Main survey layout -->
    <template id="gm_survey.custom_layout_custom" name="Survey Layout" inherit_id="web.frontend_layout" primary="True">
        <xpath expr="//head" position="before">
            <!--TODO DBE Fix me : If one day, there is a survey_livechat bridge module, put this in that module-->
            <t t-set="no_livechat" t-value="True"/>
        </xpath>
        <xpath expr="//div[@id='wrapwrap']" position="attributes">
            <attribute name="t-att-class"
                       add="(('o_survey_background o_survey_background_shadow')
                             if (question and question.background_image_url)
                             or (page and page.background_image_url)
                             or (survey and survey.background_image_url)
                             else 'o_survey_background')"
                       separator=" "/>
        </xpath>
        <xpath expr="//head/t[@t-call-assets][last()]" position="after">
            <t t-call-assets="survey.survey_assets" lazy_load="True"/>
        </xpath>
        <xpath expr="//header" position="before">
            <t t-set="no_header" t-value="True"/>
            <t t-set="no_footer" t-value="True"/>
        </xpath>
        <xpath expr="//header" position="after">
            <div id="wrap" class="oe_structure oe_empty"/>
        </xpath>
        <xpath expr="//head" position="inside">
            <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
            <t t-set="font_url" t-value="request.env['ir.config_parameter'].sudo().get_param('gm_scentopia.font_link')"/>
			<t t-set="font_family" t-value="request.env['ir.config_parameter'].sudo().get_param('gm_scentopia.font_name')"/>

			<t t-if="font_url">
					<link rel="stylesheet" t-att-href="font_url"/>
			</t>
            <style>
                .o_survey_form {
                    min-height: 100vh;
                }
                body {
					font-family: "<t t-esc="font_family or 'Poppins'"/>" !important;
                    padding-bottom: env(safe-area-inset-bottom);
                }
                h4, h1, h2, h3, p, span, label, div {
                    font-family: "<t t-esc="font_family or 'Poppins'"/>" !important;
                }
                .survey-footer {
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    width: 100%;
                    background: #fff;
                    padding: 1rem;
                    border-top: 1px solid #ddd;
                    text-align: center;
                    z-index: 999;
                }
            </style>
        </xpath>
    </template>

    <!-- Main survey template -->
    <template id="gm_survey.survey_page_fill_custom" name="Survey: main page (take survey)">
        <style>
            .shadow-top {
                box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.15);
            }
        </style>
        <t t-call="gm_survey.custom_layout_custom">
            <t t-if="answer.test_entry" t-call="survey.survey_button_form_view" />
            <div class="wrap o_survey_wrap d-flex">
                <div class="o_container_small o_survey_form d-flex flex-column" style="min-width: 100%;">
                    <!-- <t t-call="gm_survey.survey_fill_header_custom" /> -->
                    <t t-call="gm_survey.survey_fill_form_custom" />
                </div>
            </div>
             <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", function () {
                const stickyBottom = document.querySelector(".sticky-bottom");
                console.log("inisiasi stickyBottom");
                function checkScroll() {
                    console.log("checkScroll called");
                    const isBottom = window.innerHeight + window.scrollY &gt;= document.body.offsetHeight - 1;
                    console.log(window.innerHeight);
                    console.log(window.scrollY);
                    console.log(document.body.offsetHeight);
                    stickyBottom.classList.toggle("shadow-top", !isBottom);
                }

                window.addEventListener("scroll", checkScroll);
                window.addEventListener("resize", checkScroll);
                checkScroll();
            });
            </script>
        </t>
    </template>

    <template id="gm_survey.survey_fill_header_custom" name="Survey: main page header">
        <div class="o_survey_nav pt16 mb-2">
            <div class="container m-0 p-0">
                <div class="row">
                    <div  class="col-lg-10">
                        <h1 t-if="answer.state == 'new' or survey.questions_layout != 'page_per_question'"
                            t-esc="survey.title" class="o_survey_main_title pt-4"></h1>
                    </div>
                    <div class="o_survey_timer col-lg-2 pt-4">
                        <h1 class="o_survey_timer_container timer text-end">
                        </h1>
                    </div>
                </div>
            </div>
            <div t-att-class="'o_survey_breadcrumb_container mt8' + (' d-none ' if answer.state != 'in_progress' else '')"
                 t-if="not survey.has_conditional_questions and survey.questions_layout == 'page_per_section' and answer.state != 'done'"
                t-att-data-can-go-back="survey.users_can_go_back"
                t-att-data-pages="json.dumps(breadcrumb_pages)" />
        </div>
    </template>

    <template id="gm_survey.survey_fill_form_custom" name="Survey: main page content">
        <t t-set="survey_form_readonly" t-value="answer.state == 'done'"/>
        <t t-set="background_image_url"
           t-value="question.background_image_url
                    if question else page.background_image_url
                    if page else survey.background_image_url
                    if survey.background_image_url else False"/>
        <form role="form" method="post" t-att-name="survey.id"
                class="d-flex flex-grow-1 align-items-center"
                t-att-data-scoring-type="survey.scoring_type"
                t-att-data-answer-token="answer.access_token"
                t-att-data-survey-token="survey.access_token"
                t-att-data-users-can-go-back="survey.users_can_go_back and not answer.is_session_answer"
                t-att-data-session-in-progress="answer.is_session_answer"
                t-att-data-is-start-screen="answer.state == 'new'"
                t-att-data-readonly="survey_form_readonly"
                t-att-data-has-answered="bool(has_answered)"
                t-att-data-is-page-description="bool(question and question.is_page and not is_html_empty(question.description))"
                t-att-data-questions-layout="survey.questions_layout"
                t-att-data-triggered-questions-by-answer="json.dumps(triggered_questions_by_answer)"
                t-att-data-triggering-answers-by-question="json.dumps(triggering_answers_by_question)"
                t-att-data-selected-answers="json.dumps(selected_answers)"
                t-att-data-refresh-background="any(page.background_image for page in survey.page_ids)"
                style="margin-bottom:0px !important;">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <input type="hidden" name="token" t-att-value="answer.access_token" />
            <div class="o_survey_error alert alert-danger d-none" role="alert">
                <p>There was an error during the validation of the survey.</p>
            </div>

            <t t-if="answer.state == 'new'">
                <div class="o_survey_form_content w-100 position-relative " style="margin:auto; margin-top: 0px !important;">
                    <t t-call="gm_survey.survey_fill_form_start_custom"/>
                </div>
            </t>
            <t t-else="">
                <div class="o_survey_form_content w-100 position-relative" style="margin:auto; margin-top: 0px !important;"
                     t-att-data-background-image-url="background_image_url"
                     t-att-data-background-image="bool(background_image_url)">
                    <t t-if="answer.state == 'in_progress'" t-call="gm_survey.survey_fill_form_in_progress_custom" />
                    <t t-else="" t-call="gm_survey.survey_fill_form_done_custom"/>
                </div>
            </t>
        </form>

        <!-- Modal used to display error message, i.c.o. ajax error -->
        <div role="dialog" class="modal fade" id="MasterTabErrorModal" >
            <div class="modal-dialog">
                <div class="modal-content">
                    <header class="modal-header">
                        <h4 class="modal-title">A problem has occurred</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </header>
                    <main class="modal-body"><p>To take this survey, please close all other tabs on <strong class="text-danger"></strong>.</p></main>
                    <footer class="modal-footer"><button type="button" class="btn btn-primary" data-bs-dismiss="modal">Continue here</button></footer>
                </div>
            </div>
        </div>
    </template>

    <template id="gm_survey.survey_fill_form_start_custom" name="Survey: start form content">
        <style>
            body {
                background-color: #F9F2F0;
            }
            .btn-custom{
                width: 100% !important;
                border: 1px solid #5F3529  !important;
                padding: 20px 0px;
                border-radius: 1rem !important;
            }
        </style>
        <div class="wrap o_survey_start col-md-6 col-sm-12 d-flex justify-content-center align-items-center" style="height: 100vh; margin: auto;">
            <div style="40px;text-align: center;">
                <h1 style="font-size: 32px; font-weight: bold; color: #5F3529;">Welcome to Your Personality Test</h1>
                <p style="font-size:18px; color: #5F3529;">Discover insights about yourself in just a few minutes.</p>
                <div class='row'>
                    <div class='col-sm-6'>
                        <button type="submit" value="start" class="btn btn-primary mb-2 btn-lg disabled" style="width: 100%; background: white !important">
                            <span style="color: #5F3529;">Start</span>
                        </button>
                    </div>
                    <div class='col-sm-6' >
                        <a href="/choose-test" class="btn btn-primary btn-lg mb-2 " style="width: 100%; background:white !important">
                            <span style="color: #5F3529;">Back</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="gm_survey.survey_fill_form_in_progress_custom" name="Survey: form with questions">
        <style>
            .survey-footer {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                background: #fff;
                padding: 1rem;
                border-top: 1px solid #ddd;
                text-align: center;
                z-index: 999;
            }
        </style>
        <div class="o_survey_form_content_data d-none w-100"
            t-att-data-question-time-limit-reached="answer.question_time_limit_reached"
            t-att-data-has-answered="bool(has_answered)"
            t-att-data-is-page-description="bool(question and question.is_page and not is_html_empty(question.description))"
            t-att-data-server-time="server_time"
            t-att-data-timer="timer_start"
            t-att-data-time-limit-minutes="time_limit_minutes"/>
        <t t-if="survey.questions_layout == 'one_page'">
            <!-- Questions without section -->
            <t t-foreach="survey.question_ids.filtered(lambda q: not q.page_id)" t-as="question">
                <t t-if="question in answer.predefined_question_ids" t-call="gm_survey.question_container_custom"/>
            </t>
            <!-- Questions with section -->
            <t t-foreach="survey.page_ids" t-as="page">
                <t t-set="display_section" t-value="page.description or any(not q.triggering_answer_ids for q in page.question_ids)
                    or (survey.questions_selection == 'random' and page.question_ids and page.random_questions_count > 0)"/>
                <div t-attf-class="js_section_wrapper #{'d-none' if not display_section else ''}">
                    <h2 t-field="page.title" class="o_survey_title pb16 text-break"/>
                    <div t-field="page.description" class="o_survey_description text-break"/>
                    <t t-foreach="page.question_ids" t-as="question">
                        <t t-if="question in answer.predefined_question_ids" t-call="gm_survey.question_container_custom"/>
                    </t>
                </div>
            </t>

            <div class="text-center mt16 mb256">
                <button type="submit" value="finish" class="btn btn-secondary disabled">Submit</button>
                <button id="next_page" t-attf-class="btn #{'btn-secondary' if survey_last else 'btn-primary'} d-none">Next</button>
                <span class="fw-bold text-muted ms-2 d-none d-md-inline">
                    <span id="enter-tooltip">or press CTRL+Enter</span>
                </span>
            </div>
        </t>

        <t t-if="survey.questions_layout == 'page_per_section'">
            <h2 t-field='page.title' class="o_survey_title pb16 text-break" />
            <div t-field='page.description' class="oe_no_empty text-break"/>

            <input type="hidden" name="page_id" t-att-value="page.id" />
            <t t-foreach='page.question_ids' t-as='question'>
                <t t-if="question in answer.predefined_question_ids" t-call="gm_survey.question_container_custom"/>
            </t>

            <div class="row">
                <div class="col-12 text-center mt16">
                    <t t-set="submit_value" t-value="'finish' if survey_last or answer.is_session_answer else 'next_skipped'
                        if answer.survey_first_submitted and skipped_questions.page_id and page in skipped_questions.page_id else 'next'" Onclick="window.scrollTo(0,0)"/>
                    <button type="submit" t-att-value="submit_value" t-attf-class="btn #{'btn-secondary' if survey_last else 'btn-primary'} disabled" Onclick="window.scrollTo(0,0)">
                        <t t-if="submit_value == 'finish'">Submit</t>
                        <t t-elif="submit_value == 'next_skipped'">Next Skipped</t>
                        <t t-else="">Continue</t>
                    </button>
                    <button id="next_page" t-attf-class="btn #{'btn-secondary' if survey_last else 'btn-primary'} d-none" Onclick="window.scrollTo(0,0)">Next</button>
                    <span class="fw-bold text-muted ms-2 d-none d-md-inline" id="enter-tooltip"> or press CTRL+Enter</span>
                </div>
            </div>
        </t>

        <!-- Minimized display means we display the choices vertically (instead of optimized based on screen space).
        An exception is made for options with images, where we always want to optimize screen space.-->
        <t t-set="minimized_display" t-value="survey.questions_layout == 'page_per_question' and not any(suggestion.value_image for suggestion in question.suggested_answer_ids)" />
        <div t-if="survey.questions_layout == 'page_per_question'"
            t-attf-class="o_survey_page_per_question" style="padding-bottom:120px !important;">
            <input type="hidden" name="question_id" t-att-value="question.id" />
            <!-- User has already answered for this session -->
            <t t-if="answer.is_session_answer and (has_answered or answer.question_time_limit_reached)">
                <div t-if="answer.question_time_limit_reached and not has_answered" class="fw-bold">Sorry, you have not been fast enough.</div>
                <div t-else="" class="fw-bold">We have registered your answer! Please wait for the host to go to the next question.</div>
                <fieldset disabled="disabled">
                    <t t-set="survey_form_readonly" t-value="True" />
                    <div>
                        <t t-call="gm_survey.question_container_custom" />
                    </div>
                </fieldset>
            </t>
            <t t-elif="answer.is_session_answer and question.is_page and not is_html_empty(question.description)">
                <div class="fw-bold mt-5">Pay attention to the host screen until the next question.</div>
            </t>
            <t t-else="">
                <div class="w-100 p-2" style="margin-top: 0px !important;">
                    <t t-call="gm_survey.question_container_custom"/>
                </div>
                <div class="fixed-bottom" style="background-color: #fff9f7; padding: 0.5rem env(safe-area-inset-left)  calc(0.5rem + env(safe-area-inset-bottom));">
                    <div class="row">
                        <div class="col-12 text-center" style="font-style: italic; font-size: 12px;">
                            <span class="fw-bold">*Click on the answer you relate to the most</span>
                        </div>
                    </div>

                    <!-- compute submit_value once -->
                    <t t-set="submit_value" t-value="'finish' if survey_last or answer.is_session_answer else
                            'next_skipped' if answer.survey_first_submitted and skipped_questions and question in skipped_questions else 'next'" />

                    <!-- navigation bar: layout changes when finishing (submit above logo) -->
                    <div class="d-flex align-items-center justify-content-between p-2"
                         style="z-index: 999; gap: 0.75rem;">

                        <!-- Back arrow: always vertically centered -->
                        <div class="d-flex align-items-center" style="min-width:56px;">
                            <button
                                t-if="survey and survey.users_can_go_back"
                                t-att-disabled="not can_go_back"
                                type="submit"
                                class="btn border-0 p-0 shadow-none o_survey_navigation_submit d-flex align-items-center justify-content-center"
                                style="width: 56px; height: 56px;"
                                name="button_submit"
                                value="previous"
                                Onclick="window.scrollTo(0,0)"
                                t-att-data-previous-page-id="previous_page_id">
                                <img src="/gm_web/static/src/img/prev.svg" alt="Back" class="img-fluid" style="width: 36px; height: 36px; object-fit: contain;"/>
                            </button>
                        </div>

                        <!-- Center block: either logo with submit above (finish) or just logo -->
                        <div class="flex-grow-1 d-flex justify-content-center">
                            <t t-if="submit_value == 'finish'">
                                <div class="d-flex flex-column align-items-center" style="gap:0.5rem;">
                                    <button
                                        type="submit"
                                        Onclick="window.scrollTo(0,0)"
                                        t-att-value="submit_value"
                                        class="btn btn-primary btn-lg "
                                        style="padding: 4px 10px; background:white !important; border: 1px solid #5F3529;">
                                        <span style="color: #5F3529; font-size:18px;">Submit</span>
                                    </button>
                                    <img src="/gm_web/static/src/img/logo.png" class="img-fluid" style="width: 120px;" alt="Logo"/>
                                </div>
                            </t>
                            <t t-else="">
                                <img src="/gm_web/static/src/img/logo.png" class="img-fluid mb-2" style="width: 120px;" alt="Logo"/>
                            </t>
                        </div>

                        <!-- Next / Finish arrow on the right -->
                        <div class="d-flex align-items-center" style="min-width:56px;">
                            <t t-if="submit_value != 'finish'">
                                <t t-set="can_go_forward" t-value="survey and survey.questions_layout in ['page_per_question', 'page_per_section'] and answer and answer.state != 'done' and not answer.is_session_answer"/>
                                <button
                                    Onclick="window.scrollTo(0,0)"
                                    t-att-disabled="not can_go_forward"
                                    type="submit"
                                    class="btn border-0 p-0 shadow-none o_survey_navigation_submit d-flex align-items-center justify-content-center"
                                    style="width: 56px; height: 56px;"
                                    t-att-value="'next' if not survey_last else 'finish'">
                                    <img src="/gm_web/static/src/img/next.svg" alt="Next" style="width: 36px; height: 36px; object-fit: contain;"/>
                                </button>
                            </t>
                            <!-- when submit_value == finish there is no right arrow; keep space for balance -->
                            <t t-else="">
                                <div style="width:56px; height:56px;"></div>
                            </t>
                        </div>
                    </div>
                </div>
                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        setTimeout(function () {
                            window.scrollTo({ top: 0, behavior: "smooth" });
                        }, 50);
                    });
                </script>
            </t>
        </div>
    </template>

    <!-- Finished (taken and finished) survey page -->
    <template id="gm_survey.survey_fill_form_done_custom" name="Survey: finished">
        <style>
            body {
            background-color: #F9F2F0;
            }
            .btn-custom{
            width: 100% !important;
            border: 1px solid #5F3529  !important;
            padding: 20px 0px;
            border-radius: 1rem !important;
            }
        </style>
        <div class="wrap o_survey_start col-md-6 col-sm-12 d-flex justify-content-center align-items-center" style="height: 100vh; margin: auto;">
            <div style="padding: 40px;;text-align: center;">
                <h1 style="font-size: 32px; font-weight: bold; color: #5F3529;">Welcome to Your Personality Test</h1>
                <p style="font-size:18px; color: #5F3529;">Discover insights about yourself in just a few minutes.</p>
                <div class='row'>
                    <div class='col-sm-12'>
                        <a role="button" class="o_survey_review btn btn-primary btn-lg mb-2" style="width: 100%; background: white !important; border: 1px solid #5F3529;"
                            t-att-href="'/survey/print/%s?answer_token=%s&amp;review=True' % (survey.access_token, answer.access_token)">
                            <span style="color: #5F3529;">See The Results</span>
                        </a>
                    </div>
                    <div class='col-sm-12'>
                        <a style="width: 100%;" href="/choose-test">
                            <span style="color: #5F3529;">Take Again</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Question widgets -->
    <template id="gm_survey.question_container_custom" name="Survey: question container">
        <style>
            body {
            background-color: #fff9f7;
            }
            .top-container {
            background-color: #eac3bb;
            border-radius: 1rem;
            padding: 0.5rem 2rem 1rem;
            }
            .progress-container {
            position: relative;
            text-align: center;
            margin-bottom: 1rem;
            }
            .progress-bar-background {
            background-color: white;
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
            }
            .progress-bar-fill {
            background-color: #b76c6c;
            width: 20%;
            height: 8px;
            }
            .progress-text {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 600;
            color: #b76c6c;
            }
            .question-box {
            background-color: white;
            padding: 1rem 1.25rem 0.5rem;
            border-radius: 0.75rem;
            font-weight: 500;
            color: #333;
            line-height: 1.6;
            }
            .answer-box {
            border: 1px solid #eac3bb;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            color: #333;
            transition: background-color 0.2s;
            }
            .answer-box:hover {
            background-color: #fff0ed;
            }
            .brand {
            font-size: 1.75rem;
            font-weight: bold;
            }
            .brand span {
            color: #f89aa3;
            }
            .brand .blue {
            color: #89d0eb;
            }
        </style>
        <t t-set="display_question"
           t-value="survey.questions_layout == 'page_per_question'
                    or survey.questions_selection == 'random'
                    or (survey.questions_layout == 'one_page' and not question.triggering_answer_ids)
                    or (survey.questions_layout == 'page_per_section' and (not question.triggering_answer_ids
                        or any(triggering_answer in selected_answers for triggering_answer in triggering_answers_by_question[question.id])))"/>

        <t t-set="answer_lines" t-value="answer.user_input_line_ids.filtered(lambda line: line.question_id == question)"/>
        <t t-set="answers_contain_image" t-value="any(a.value_image for a in question.suggested_answer_ids)"/>
        <t t-set="use_half_columns" t-value="survey.questions_layout == 'page_per_question' and answers_contain_image"/>
        <t t-set="use_half_col_lg" t-value="'col-lg-6' if (use_half_columns and not survey_form_readonly) or (answer.is_session_answer and answers_contain_image) else ''"/>
        <!--Use Key selection if number of choices is < 26 to keep Z for other choice if any-->
        <t t-set="letters" t-value="'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"/>
        <t t-set="useKeySelection" t-value="len(question.suggested_answer_ids) &lt; len(letters) and survey.questions_layout == 'page_per_question'"/>
        <!-- Extra 'right' margin is added on layouts that are not "page_per_question" to align with choices questions, since all choices have a me-2 class (pixel perfect yay...) -->
        <t t-set="extra_right_margin" t-value="survey.questions_layout != 'page_per_question' and question.question_type not in ['simple_choice', 'multiple_choice']"/>
        <t t-set="default_constr_error_msg">This question requires an answer.</t>
        <t t-set="default_validation_error_msg">The answer you entered is not valid.</t>
        <t t-set="default_comments_message">If other, please specify:</t>
        <t t-set="is_skipped_question" t-value="skipped_questions and question in skipped_questions"/>
        <div t-attf-class="js_question-wrapper pb-4
                           #{'d-none' if not display_question else ''}
                           #{'me-2' if extra_right_margin else ''}"
             t-att-id="question.id"
             t-att-data-required="bool(question.constr_mandatory and (not survey.users_can_go_back or survey.questions_layout == 'one_page')) or None"
             t-att-data-constr-error-msg="question.constr_error_msg or default_constr_error_msg if question.constr_mandatory else None"
             t-att-data-validation-error-msg="question.validation_error_msg or default_validation_error_msg if question.validation_required else None" style="min-width: 100%; ">
             <div class="top-container mb-3">
                <div class="d-flex flex-column">
                    <!-- <button class="btn text-white fs-4">&larr;</button> -->
                    <div class="row">
                        <div class="flex-grow-1" >
                            <div class="progress-container" style="margin:auto;">
                                <div class="o_survey_progress_wrapper d-inline-block text-start" style="margin-bottom:-13px;">
                                    <t t-call="gm_survey.survey_progression_custom"
                                        t-if="survey and survey.questions_layout != 'one_page' and answer and answer.state == 'in_progress' and (not question or not question.is_page) and not survey_form_readonly">
                                        <t t-if="survey.questions_layout == 'page_per_section'">
                                            <t t-set="page_ids" t-value="survey.page_ids.ids"/>
                                            <t t-set="page_number" t-value="page_ids.index(page.id) + (1 if survey.progression_mode == 'number' else 0)"/>
                                        </t>
                                        <t t-else="">
                                            <t t-if="not answer.is_session_answer and survey.questions_selection == 'random'">
                                                <t t-set="page_ids" t-value="answer.predefined_question_ids.ids"/>
                                            </t>
                                            <t t-else="">
                                                <t t-set="page_ids" t-value="survey.question_ids.ids"/>
                                            </t>
                                            <t t-set="page_number" t-value="page_ids.index(question.id)"/>
                                        </t>
                                    </t>    
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="question-box text-center" style="box-shadow: 0 2px 4px 0 #B17B67;">
                            <h4 t-if="not hide_question_title">
                                <span t-field='question.title' class="text-break" />
                                <span t-if="question.constr_mandatory" class="text-danger">*</span>
                            </h4>
                        </div>
                    </div>
                </div>
            </div>
            <t t-if="question.question_type == 'text_box'" t-call="gm_survey.question_text_box_custom"/>
            <t t-if="question.question_type == 'char_box'" t-call="gm_survey.question_char_box_custom"/>
            <t t-if="question.question_type == 'numerical_box'" t-call="gm_survey.question_numerical_box_custom"/>
            <t t-if="question.question_type == 'date'" t-call="gm_survey.question_date_custom"/>
            <t t-if="question.question_type == 'datetime'" t-call="gm_survey.question_datetime_custom"/>
            <t t-if="question.question_type == 'simple_choice'" t-call="gm_survey.question_simple_choice_custom"/>
            <t t-if="question.question_type == 'scale'" t-call="gm_survey.question_scale_custom"/>
            <t t-if="question.question_type == 'multiple_choice'" t-call="gm_survey.question_multiple_choice_custom"/>
            <t t-if="question.question_type == 'matrix'" t-call="gm_survey.question_matrix_custom"/>
            <t t-if="question.question_type == 'video'" t-call="gm_survey.question_video_custom_custom"/>
            <div t-attf-class="o_survey_question_error d-flex align-items-center justify-content-between overflow-hidden
                 border-0 py-0 px-3 alert alert-danger mt-2 #{'slide_in' if is_skipped_question else ''}" role="alert">
                <span t-if="is_skipped_question" t-out="question.constr_error_msg or default_constr_error_msg"/>
            </div>
        </div>
    </template>

    <template id="gm_survey.question_text_box_custom" name="Question: free text box">
        <div class="o_survey_comment_container h-auto p-0">
            <textarea class="form-control o_survey_question_text_box bg-transparent rounded-0 p-0" rows="3"
                      t-att-name="question.id" t-att-placeholder="question.question_placeholder"
                      t-att-data-question-type="question.question_type"><t t-if="answer_lines" t-esc="answer_lines[0].value_text_box or None"/></textarea>
        </div>
    </template>

    <template id="gm_survey.question_char_box_custom" name="Question: text box">
        <div class="o_survey_comment_container p-0">
            <input t-att-type="'email' if question.validation_email else 'text'"
               class="form-control o_survey_question_text_box bg-transparent rounded-0 p-0"
               t-att-name="question.id" t-att-placeholder="question.question_placeholder"
               t-att-value="answer_lines[0].value_char_box if answer_lines else None"
               t-att-data-question-type="question.question_type"
               t-att-data-validation-length-min="question.validation_length_min if question.validation_required else False"
               t-att-data-validation-length-max="question.validation_length_max if question.validation_required else False"/>
        </div>
    </template>

    <template id="gm_survey.question_numerical_box_custom" name="Question: numerical box">
        <div class="o_survey_answer_wrapper p-1 rounded">
            <input type="number" step="any" class="form-control o_survey_question_numerical_box bg-transparent rounded-0 p-0"
                t-att-name="question.id" t-att-placeholder="question.question_placeholder"
                t-att-value="answer_lines[0].value_numerical_box if answer_lines else None"
                t-att-data-question-type="question.question_type"
                t-att-data-validation-float-min="question.validation_min_float_value if question.validation_required else False"
                t-att-data-validation-float-max="question.validation_max_float_value if question.validation_required else False"/>
        </div>
    </template>

    <template id="gm_survey.question_scale_custom" name="Question: scale">
        <!-- A question already answered that the user resets is marked as skipped and not deleted, -->
        <!-- so we use the flag skipped to restore or not the answer state. -->
        <t t-set="answer_line" t-value="answer_lines and not answer_lines[0].skipped and answer_lines[0]"/>
        <div class="o_survey_answer_wrapper o_survey_form_choice"
             t-att-data-name="question.id"
             t-att-data-is-skipped-question="is_skipped_question or None"
             data-question-type="scale">
            <div role="radiogroup" class="btn-group d-flex mb-2" t-att-aria-label="">
                <t t-foreach="range(question.scale_min, question.scale_max + 1)" t-as="value">
                    <t t-set="answer_selected" t-value="answer_line and answer_line.value_scale == value"/>
                    <label t-attf-class="o_survey_choice_btn flex-shrink-1 rounded text-nowrap #{'me-2' if not value_last else ''} #{'o_survey_selected' if answer_selected else ''}"
                           t-attf-for="{{ question.id }}_{{ value }}">
                        <div class="d-none d-md-flex align-items-center fs-5">
                            <div class="fw-bold my-3 flex-fill align-self-center text-center" t-out="value"/>
                            <i class="fa fa-check-circle me-1 my-3"/>
                            <i class="fa fa-circle-thin me-1 my-3"/>
                        </div>
                        <div class="d-block d-md-none my-3 text-center fs-5">
                            <div class="fw-bold" t-out="value"/>
                            <i class="fa fa-check-circle"/>
                            <i class="fa fa-circle-thin"/>
                        </div>
                        <input autocomplete="off"
                               class="btn-check"
                               type="radio"
                               t-attf-class="o_survey_form_choice_item invisible position-absolute #{'o_survey_form_choice_item_selected' if answer_selected else ''}"
                               t-att-data-selection-key="letters[value_index] if useKeySelection else ''"
                               t-attf-name="{{ question.id }}"
                               t-att-checked="'checked' if answer_selected else None"
                               t-attf-value="{{ value }}"
                               t-attf-id="{{ question.id }}_{{ value }}"
                        />
                    </label>
                </t>
            </div>
            <div t-if="question.scale_min_label or question.scale_mid_label or question.scale_max_label"
                 class="d-flex justify-content-between text-primary">
                <div class="text-start" t-out="question.scale_min_label"/>
                <div class="text-center" t-out="question.scale_mid_label"/>
                <div class="text-end" t-out="question.scale_max_label"/>
            </div>
        </div>
    </template>

    <template id="gm_survey.question_date_custom" name="Question: date box">
        <div class="input-group o_survey_form_date o_survey_answer_wrapper p-1 rounded">
            <input type="text" class="form-control datetimepicker-input o_survey_question_date bg-transparent rounded-0 p-0"
                   t-att-name="question.id" t-att-placeholder="question.question_placeholder"
                   t-att-value="format_date(answer_lines[0].value_date) if answer_lines else None"
                   t-att-data-question-type="question.question_type"
                   data-widget="datetime-picker" data-widget-type="date"
                   t-att-data-min-date="question.validation_min_date"
                   t-att-data-max-date="question.validation_max_date"/>
            <div t-if="not survey_form_readonly" class="position-absolute input-group-text o_input_group_date_icon text-primary border-0 bg-transparent p-0 end-0"><i class="fa fa-calendar"></i></div>
        </div>
    </template>

    <template id="gm_survey.question_datetime_custom" name="Question: datetime box">
        <div class="input-group o_survey_form_date o_survey_answer_wrapper p-1 rounded">
            <input type="text" class="form-control datetimepicker-input o_survey_question_datetime bg-transparent rounded-0 p-0"
                   t-att-name="question.id" t-att-placeholder="question.question_placeholder"
                   t-att-value="format_datetime(answer_lines[0].value_datetime) if answer_lines else None"
                   t-att-data-question-type="question.question_type"
                   data-widget="datetime-picker" data-widget-type="datetime"
                   t-att-data-min-date="question.validation_min_datetime"
                   t-att-data-max-date="question.validation_max_datetime"/>
            <div t-if="not survey_form_readonly" class="position-absolute input-group-text o_input_group_date_icon text-primary border-0 bg-transparent p-0 end-0"><i class="fa fa-calendar"></i></div>
        </div>
    </template>

    <template id="gm_survey.question_suggested_value_image_custom" name="Image from the question suggested answer">
        <t t-if="label.value_image">
            <!-- Directly use field or route if the user doesn't have access rights -->
            <div t-if="not env.user.has_group('survey.group_survey_user')"
                class="o_survey_choice_img d-flex my-3 justify-content-center">
                <img t-att-src="'/survey/get_question_image/%s/%s/%s/%s' % (survey.access_token, answer.access_token, question.id, label.id)" class="mw-100 h-auto"/>
            </div>
            <div t-else=""  t-field="label.value_image"
                class="o_survey_choice_img d-flex my-3 justify-content-center"
                t-options="{'widget': 'image', 'alt-field': 'name', 'itemprop': 'image'}"/>
        </t>
    </template>

    <template id="gm_survey.question_simple_choice_custom" name="Question: simple choice">
        <style>
            .option-card {
                display: flex;
                align-items: center;
                justify-content: flex-start;
                height: auto !important;
                min-height: 64px;
                padding: 0.5rem 1rem !important;
                font-size: 1 rem;
                line-height: 1.5;
                border: 2px solid transparent;
                border-radius: 1.25rem !important;
                background-color: #fff !important;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05) !important;
                cursor: pointer;
                transition: all 0.2s ease !important;
                text-align: left;
                word-wrap: break-word;
            }

            .option-card:hover {
                background-color: #f5eefc !important;
                transform: scale(1.01);
            }
            .option-card

            input[type="radio"] {
                display: none;
            }

            input[type="radio"]:checked + .option-card {
                background-color: #e7d4f5;
                border-color: #a375d9;
                box-shadow: 0 0 0 3px rgba(163, 117, 217, 0.3);
            }
        </style>
        <t t-set="answer_line" t-value="answer_lines.filtered(lambda line: line.suggested_answer_id)"/>
        <t t-set="comment_line" t-value="answer_lines.filtered(lambda line: line.value_char_box)"/>
        <div class="g-2 o_survey_answer_wrapper o_survey_form_choice"
             t-att-data-name="question.id"
             t-att-data-is-skipped-question="is_skipped_question or None"
             data-question-type="simple_choice_radio">
            <t t-set="item_idx" t-value="0"/>
            <t t-set="has_correct_answer" t-value="scoring_display_correction and any(label.is_correct for label in question.suggested_answer_ids)"/>
            <t t-foreach='question.random_options(question.suggested_answer_ids)' t-as='label'>
                <div class="row mb-2" >
                    <t t-set="item_idx" t-value="label_index"/>
                    <t t-set="answer_selected" t-value="answer_line and answer_line.suggested_answer_id.id == label.id"/>

                    <!--Used for print mode with corrections -->
                    <t t-set="answer_class" t-value="'' if not has_correct_answer else 'bg-success' if label.is_correct else 'bg-danger'"/>

                    <div t-attf-class="col-sm-12 col-md-6" style="margin: auto; ">
                        <label t-att-for="str(question.id) + '_' + str(label.id)"
                            t-attf-class="option-card o_survey_choice_btn py-1 px-3 w-100 h-100 rounded #{answer_class} #{'o_survey_selected' if answer_selected else ''}">
                            <t t-if="has_correct_answer and answer_selected">
                                <!-- While displaying results: change icons to have a check mark for a right answer and a cross for a wrong one -->
                                <i t-if="label.is_correct" class="float-end mt-1 position-relative d-inline fa fa-check-circle"/>
                                <i t-else="" class="float-end mt-1 position-relative d-inline fa fa-times-circle"/>
                            </t>
                            <t t-else="">
                                <i class="fa fa-check-circle float-end mt-1 ms-1 position-relative"/>
                                <i class="fa fa-circle-thin float-end mt-1 ms-1 position-relative"/>
                            </t>
                            <input t-att-id="str(question.id) + '_' + str(label.id)" type="radio" t-att-value='label.id'
                                t-attf-class="o_survey_form_choice_item invisible position-absolute #{'o_survey_form_choice_item_selected' if answer_selected else ''}"
                                t-att-name='question.id'
                                t-att-checked="'checked' if answer_selected else None"
                                t-att-data-selection-key="letters[item_idx] if useKeySelection else ''"/>
                            <span class="ms-2 text-break" t-field='label.value'/>
                            <t t-call="gm_survey.question_suggested_value_image_custom"/>
                        </label>
                    </div>
                </div>
            </t>
            <t t-if='question.comments_allowed and question.comment_count_as_answer'>
                <div t-attf-class="col-sm-12 #{use_half_col_lg}">
                    <label t-attf-class="o_survey_choice_btn py-1 px-3 h-100 w-100 rounded #{'o_survey_selected' if comment_line else ''}">
                        <t t-set="item_idx" t-value="item_idx + 1"/>
                        <t t-call="gm_survey.survey_selection_key_custom">
                            <t t-set="selection_key_class" t-value="'position-relative o_survey_radio_btn float-start d-flex'"/>
                        </t>
                        <i class="fa fa-check-circle float-end mt-1 ms-1 position-relative"/>
                        <i class="fa fa-circle-thin float-end mt-1 ms-1 position-relative"/>
                        <input type="radio" class="o_survey_form_choice_item o_survey_js_form_other_comment invisible position-absolute" value="-1"
                            t-att-name='question.id'
                            t-att-checked="comment_line and 'checked' or None"
                            t-att-data-selection-key="letters[item_idx] if useKeySelection else ''"/>
                        <span class="ms-2" t-out="question.comments_message or default_comments_message" />
                    </label>
                </div>
                <div t-attf-class="o_survey_comment_container mt-3 py-0 px-1 h-auto #{'d-none' if not comment_line else ''}">
                    <textarea type="text" class="form-control o_survey_question_text_box bg-transparent rounded-0 p-0"
                        t-att-disabled="None if comment_line else 'disabled'"><t t-esc="comment_line.value_char_box if comment_line else ''"/></textarea>
                </div>
            </t>
            <div t-if='question.comments_allowed and not question.comment_count_as_answer'
                class="mb-2 o_survey_comment_container mt-3">
                <textarea type="text" class="col form-control o_survey_comment o_survey_question_text_box bg-transparent rounded-0 p-0"
                    t-att-placeholder="question.comments_message or default_comments_message if not survey_form_readonly else ''"><t t-esc="comment_line.value_char_box if comment_line else ''"/></textarea>
            </div>
        </div>
    </template>

    <template id="gm_survey.question_multiple_choice_custom" name="Question: multiple choice">
        <t t-set="comment_line" t-value="answer_lines.filtered(lambda line: line.value_char_box)"/>
        <div class="row g-2 o_survey_answer_wrapper o_survey_form_choice o_survey_question_multiple_choice"
             t-att-data-name="question.id"
             t-att-data-question-type="question.question_type">
            <t t-set="item_idx" t-value="0"/>
            <t t-set="has_correct_answer" t-value="scoring_display_correction and any(label.is_correct for label in question.suggested_answer_ids)"/>
            <t t-foreach='question.suggested_answer_ids' t-as='label'>
                <t t-set="item_idx" t-value="label_index"/>
                <t t-set="answer_line" t-value="answer_lines.filtered(lambda line: line.suggested_answer_id == label)"/>
                <t t-set="answer_selected" t-value="answer_line and answer_line.suggested_answer_id.id == label.id"/>

                <!--Used for print mode with corrections -->
                <t t-set="answer_class" t-value="'' if not has_correct_answer else 'bg-success' if label.is_correct else 'bg-danger'"/>

                <div t-attf-class="col-sm-12 #{use_half_col_lg}">
                    <label t-attf-class="o_survey_choice_btn py-1 px-3 w-100 h-100 rounded #{answer_class} #{'o_survey_selected' if answer_selected else ''}">
                        <t t-call="gm_survey.survey_selection_key_custom">
                            <t t-set="selection_key_class" t-value="'position-relative float-start d-flex'"/>
                        </t>
                        <!-- While displaying results: change icons to have a check mark for a right answer and a cross for a wrong one -->
                        <i t-if="has_correct_answer and answer_selected" t-attf-class="float-end mt-1 position-relative d-inline
                            fa #{'fa-check-square' if is_correct else 'fa-times-square'}"/>
                        <t t-else="">
                            <i class="fa fa-check-square float-end mt-1 ms-1 position-relative"/>
                            <i class="fa fa-square-o float-end mt-1 ms-1 position-relative"/>
                        </t>
                        <input type="checkbox" t-att-value='label.id' class="o_survey_form_choice_item invisible position-absolute"
                            t-att-name="question.id"
                            t-att-checked="'checked' if answer_line else None"
                            t-att-data-selection-key="letters[item_idx] if useKeySelection else ''"/>
                        <span class="ms-2 text-break" t-field='label.value'/>
                        <t t-call="gm_survey.question_suggested_value_image_custom"/>
                    </label>
                </div>
            </t>
            <t t-if='question.comments_allowed and question.comment_count_as_answer'>
                <div t-attf-class="col-sm-12 #{use_half_col_lg}">
                    <label t-attf-class="o_survey_choice_btn py-1 px-3 h-100 w-100 rounded #{'o_survey_selected' if comment_line else ''}">
                        <t t-set="item_idx" t-value="item_idx + 1"/>
                        <t t-call="gm_survey.survey_selection_key_custom">
                            <t t-set="selection_key_class" t-value="'position-relative float-start d-flex'"/>
                        </t>
                        <i class="fa fa-check-square float-end mt-1 ms-1 position-relative"/>
                        <i class="fa fa-square-o float-end mt-1 ms-1 position-relative"/>
                        <input type="checkbox" class="o_survey_form_choice_item o_survey_js_form_other_comment invisible position-absolute" value="-1"
                            t-att-name="question.id"
                            t-att-checked="comment_line and 'checked' or None"
                            t-att-data-selection-key="letters[item_idx] if useKeySelection else ''"/>
                        <span class="ms-2" t-out="question.comments_message or default_comments_message" />
                    </label>
                </div>
                <div t-attf-class="o_survey_comment_container mt-3 py-0 h-auto px-1 #{'d-none' if not comment_line else ''}">
                    <textarea type="text" class="form-control o_survey_question_text_box bg-transparent rounded-0 p-0"
                        t-att-disabled="None if comment_line else 'disabled'"><t t-esc="comment_line.value_char_box if comment_line else ''"/></textarea>
                </div>
            </t>
            <div t-if='question.comments_allowed and not question.comment_count_as_answer' class="mb-2 o_survey_comment_container mt-3">
                <textarea type="text" class="col form-control o_survey_comment o_survey_question_text_box bg-transparent rounded-0 p-0"
                    t-att-placeholder="question.comments_message or default_comments_message if not survey_form_readonly else ''"><t t-esc="comment_line.value_char_box if comment_line else ''"/></textarea>
            </div>
        </div>
    </template>

    <template id="gm_survey.question_matrix_custom" name="Question: matrix">
        <t t-set="comment_line" t-value="answer_lines.filtered(lambda line: line.value_char_box)"/>
        <table class="table table-borderless o_survey_question_matrix text-white text-center mb-0"
               t-att-data-name="question.id"
               t-att-data-question-type="question.question_type"
               t-att-data-sub-questions="question.matrix_row_ids.ids">
            <thead>
                <tr>
                    <th> </th>
                    <th class="fw-normal" t-foreach="question.suggested_answer_ids" t-as="col_label"><span t-field="col_label.value" /></th>
                </tr>
            </thead>
            <tbody>
                <t t-set="item_idx" t-value="0"/>
                <!-- For matrix, we have an extra check because we have rows * columns total options -->
                <t t-set="useKeySelection" t-value="useKeySelection and (len(question.suggested_answer_ids) * len(question.matrix_row_ids)) &lt; len(letters)" />
                <tr class="bg-white text-white" t-foreach="question.matrix_row_ids" t-as="row_label" t-att-id="row_label.id">
                    <th class="fw-normal text-start"><span t-field="row_label.value" /></th>
                    <t t-foreach="question.suggested_answer_ids" t-as="col_label">
                        <t t-set="answer" t-value="answer_lines.filtered(lambda line: line.suggested_answer_id == col_label and line.matrix_row_id == row_label)"/>
                        <td t-att-class="'o_survey_matrix_btn text-primary position-relative %s'
                        % ('o_survey_selected' if answer else '')">
                            <input t-att-type="'checkbox' if question.matrix_subtype == 'multiple' else 'radio'"
                                   t-att-name="'%s_%s' % (question.id, row_label.id)" t-att-value='col_label.id'
                                   t-att-checked="'checked' if answer else None"
                                   t-att-data-row-id="row_label.id"
                                   t-att-data-selection-key="letters[item_idx] if useKeySelection else ''"
                                   class="o_survey_form_choice_item d-none"/>
                            <i t-att-class="'o_survey_matrix_empty_checkbox fa fa-%s position-relative'
                            % ('square-o' if question.matrix_subtype == 'multiple' else 'circle-thin')"></i>
                            <i t-att-class="'fa fa-%s position-relative'
                            % ('check-square' if question.matrix_subtype == 'multiple' else 'check-circle')"></i>
                            <t t-call="gm_survey.survey_selection_key_custom">
                                <t t-set="selection_key_class"
                                   t-value="'position-absolute float-end fw-bold %s' % ('o_survey_radio_btn' if question.matrix_subtype != 'multiple' else '')"/>
                            </t>
                            <t t-set="item_idx" t-value="item_idx + 1"/>
                        </td>
                    </t>
                </tr>
            </tbody>
        </table>
        <div t-if='question.comments_allowed'>
            <textarea type="text" class="form-control o_survey_question_text_box o_survey_comment bg-transparent rounded-0 p-0 mt-3"
                      t-att-placeholder="question.comments_message or default_comments_message if not survey_form_readonly else ''"
                      t-att-name="'%s_%s' % (question.id, 'comment')"><t t-esc="comment_line.value_char_box if comment_line else ''"/></textarea>
        </div>
    </template>

    <template id="gm_survey.survey_selection_key_custom">
        <div t-if="useKeySelection" t-att-class="'o_survey_choice_key bg-white rounded %s' % selection_key_class">
             <span class="o_survey_key text-center position-absolute bg-white rounded-start py-0 ps-2"><span class="text-primary text-center text-center w-100 position-relative">Key</span></span>
             <span class="text-primary text-center w-100 position-relative" t-esc="letters[item_idx]"/>
        </div>
    </template>

    <template id="gm_survey.survey_progression_custom" name="Survey: Progression">
        <style>
            .progress-arc-wrapper {
                position: relative;
                <!-- width: 200px; -->
                height: 75px;
                margin: 0 auto;
                padding: 0;
            }

            svg {
                width: 200px;
                height: 75px;
                display: block;
                margin: 0;
                padding: 0;
            }

            path {
                stroke-linecap: round;
                stroke-width: 15;
            }

            path.white {
                stroke: white;
                stroke-width: 25;
            }

            path.brown {
                stroke: #C48080;
                stroke-width: 15;
                stroke-dasharray: calc(3.1416 * 90);
                stroke-dashoffset: calc((1 - (var(--percent) / 100)) * 3.1416 * 90);
                transition: stroke-dashoffset 1s ease;
            }

            .progress-xofy {
                position: absolute;
                top: 65%; /* Adjust to center text vertically inside arc */
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 20px !important;
                font-weight: 600;
                color: #b76c6c;
                z-index: 10;
                line-height: 1;
                margin: 0;
                padding: 0;
            }
        </style>

        <t t-if="len(page_ids) > 1 and not survey.has_conditional_questions">
            <t t-set="current_page" t-value="page_number + 1"/>
            <t t-set="percentage" t-value="round(100*((current_page) / len(page_ids)))"/>
            <t t-set="total_pages" t-value="len(page_ids)"/>

            <div class="progress-arc-wrapper">
                <div class="progress-xofy">
                    <t t-esc="current_page"/> / <t t-esc="total_pages"/>
                </div>
                <svg viewBox="-10 -10 250 110" xmlns="http://www.w3.org/2000/svg">
                    <path class="white" d="M10,100 A90,90 0 0,1 190,100" style="fill:white;" />
                    <path class="brown" d="M10,100 A90,90 0 0,1 190,100"
                        t-att-style="'--percent: ' + str(percentage) + '; fill:none;'"/>
                </svg>
            </div>
        </t>
    </template>



    <template id="gm_survey.question_video_custom_custom" name="Question: Video">
        <t t-set="answer_line" t-value="answer_lines.filtered(lambda line: line.suggested_answer_id)"/>
        <t t-set="comment_line" t-value="answer_lines.filtered(lambda line: line.value_char_box)"/>
        <div class="row g-2 o_survey_answer_wrapper o_survey_form_choice"
            t-att-data-name="question.id"
            t-att-data-is-skipped-question="is_skipped_question or None"
            data-question-type="video">
            <t t-set="item_idx" t-value="0"/>
            <t t-set="has_correct_answer" t-value="scoring_display_correction and any(label.is_correct for label in question.suggested_answer_ids)"/>
            <t t-foreach='question.suggested_answer_ids' t-as='label'>
                <t t-set="item_idx" t-value="label_index"/>
                <t t-set="answer_selected" t-value="answer_line and answer_line.suggested_answer_id.id == label.id"/>

                <!--Used for print mode with corrections -->
                <t t-set="answer_class" t-value="'' if not has_correct_answer else 'bg-success' if label.is_correct else 'bg-danger'"/>

                <div t-attf-class="col-sm-12 #{use_half_col_lg}">
                    <label t-att-for="str(question.id) + '_' + str(label.id)"
                        t-attf-class="o_survey_choice_btn py-1 px-3 w-100 h-100 rounded #{answer_class} #{'o_survey_selected' if answer_selected else ''}">
                        
                        <t t-if="has_correct_answer and answer_selected">
                            <!-- While displaying results: change icons to have a check mark for a right answer and a cross for a wrong one -->
                            <i t-if="label.is_correct" class="float-end mt-1 position-relative d-inline fa fa-check-circle"/>
                            <i t-else="" class="float-end mt-1 position-relative d-inline fa fa-times-circle"/>
                        </t>
                        <t t-else="">
                            <i class="fa fa-check-circle float-end mt-1 ms-1 position-relative"/>
                            <i class="fa fa-circle-thin float-end mt-1 ms-1 position-relative"/>
                        </t>
                        <input t-att-id="str(question.id) + '_' + str(label.id)" type="radio" t-att-value='label.id'
                            t-attf-class="o_survey_form_choice_item invisible position-absolute #{'o_survey_form_choice_item_selected' if answer_selected else ''}"
                            t-att-name='question.id'
                            t-att-checked="'checked' if answer_selected else None"
                            t-att-data-selection-key="letters[item_idx] if useKeySelection else ''"/>
                        <span class="ms-2 text-break" t-field='label.value'/>
                        <t t-call="gm_survey.question_suggested_value_image_custom"/>
                    </label>
                </div>
            </t>
        </div>
    </template>
</data>
</odoo>
