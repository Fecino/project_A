<?xml version="1.0" ?>
<odoo>
	<data>
		<template id="oil_drop_template" name="Oil Drop Counting">
			<t t-call="website.layout">
				<t t-set="title">Perfume Journey - Oil Drop</t>
				<t t-set="additional_title">Scentzania</t>
				<t t-set="font_url" t-value="request.env['ir.config_parameter'].sudo().get_param('gm_scentopia.font_link')"/>
				<t t-set="font_family" t-value="request.env['ir.config_parameter'].sudo().get_param('gm_scentopia.font_name')"/>

				<t t-if="font_url">
						<link rel="stylesheet" t-att-href="font_url"/>
				</t>
				<style>
					body {
						font-family: "<t t-esc="font_family or 'Poppins'"/>" !important;
					}
					.perfume-wrapper {
						min-height: 100vh;
						padding-top: 60px;
						padding-bottom: 20px;
					}
					
					.category-header {
						background-color: rgba(255, 255, 255, 0.6);
						backdrop-filter: blur(10px);
						top: 0;
						z-index: 10;
					}
					
					.perfume-card {
						background-color: rgba(255, 255, 255, 0.6);
						backdrop-filter: blur(10px);
						transition: transform 0.3s ease;
						max-width: 500px;
						border-radius: 25px;
					}
					
					.bottom-nav {
						background: #f7e0d5;
						height: 60px;
					}
					
					.dynamic-avatar {
						width: 55px;
						height: 55px;
						object-fit: contain;
						filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));
					}
					
					/* Category-specific styles */
					.perfume-wrapper.citrus {
						background-image: url('/gm_web/static/src/img/05_perfume_start_01_citrus.png');
						background-color: #FFB347;
						background-size: cover;
						background-position: center;
					}
					
					.perfume-wrapper.fresh {
						background-image: url('/gm_web/static/src/img/05_perfume_start_01_fresh.png');
						background-color: #4FC3F7;
						background-size: cover;
						background-position: center;
					}
					
					.perfume-wrapper.floral {
						background-image: url('/gm_web/static/src/img/05_perfume_start_01_floral.png');
						background-color: #FF6B9D;
						background-size: cover;
						background-position: center;
					}
					
					.perfume-wrapper.woody {
						background-image: url('/gm_web/static/src/img/05_perfume_start_01_woody.png');
						background-color: #8B4513;
						background-size: cover;
						background-position: center;
					}
					
					.perfume-wrapper.oriental {
						background-image: url('/gm_web/static/src/img/05_perfume_start_01_oriental.png');
						background-color: #D32F2F;
						background-size: cover;
						background-position: center;
					}
					
					.citrus .btn-confirm {
						background: linear-gradient(135deg, #FFB347, #ff9a56) !important;
						color: #fff !important;
					}
					
					.fresh .btn-confirm {
						background: linear-gradient(135deg, #4FC3F7, #4facfe) !important;
						color: #fff !important;
					}
					
					.floral .btn-confirm {
						background: linear-gradient(135deg, #FF6B9D, #ff6b9d) !important;
						color: #fff !important;
					}
					
					.woody .btn-confirm {
						background: linear-gradient(135deg, #8B4513, #8b4513) !important;
						color: #fff !important;
					}
					
					.oriental .btn-confirm {
						background: linear-gradient(135deg, #D32F2F, #8b0000) !important;
						color: #fff !important;
					}
					
					.perfume-card-container {
						min-height: calc(100vh - 120px);
						margin-bottom: 140px;
						overflow-y: auto;
						overflow-x: hidden;
					}
					
					@media (max-height: 700px) {
						.perfume-card-container {
							min-height: calc(100vh - 400px);
							margin-top: 20px;
							margin-bottom: 200px;
							overflow-y: auto;
							overflow-x: hidden;
							padding-top: 150px;
						}
					}
				</style>
				
				<div style="height: 100vh; position: fixed; top: 0; left: 0; right: 0; bottom: 0; overflow: hidden;" t-att-class="'perfume-wrapper ' + category">
					<div id="perfumeStartWrapper" class="d-flex flex-column position-relative" style="height:100vh">
						<div id="categoryHeader" class="category-header d-flex justify-content-between align-items-center position-fixed w-100 py-2 px-3" style="color:black !important; top: 0;">
							<div class="text-start">
								<span id="categoryCounter" class="d-block">This Is your <t t-esc="oil_order"/> Oil</span>
								<span id="scentType" class="d-block small"> <t t-esc="category.capitalize()"/> Scent Wand</span>
							</div>
							<div class="text-end">
								<span id="totalCounter" class="d-block"><t t-esc="oil_added_count"/> / <t t-esc="oil_max"/> Drops</span>
								<span id="totalCounterText" class="d-block small">Remaining <t t-esc="oil_max - oil_added_count"/> Drops </span>
							</div>
						</div>
						
						<div class="flex-fill d-flex flex-column justify-content-center align-items-center px-3 position-relative perfume-card-container">
							<div class="perfume-card mx-auto mb-4 p-4 w-100">
								<div class="text-center" style="color:#2C2C2C !important">
									<h3 style="color:#2C2C2C !important">Your Remaining <t t-esc="fragrance_name.capitalize()"/> oil is</h3>
									<h1 style="font-weight: 800; font-size: 50px; color:#2C2C2C !important"><t t-esc="value[fragrance_name]"/> DROPS</h1>
								</div>
							</div>
							
							<div class="perfume-card mx-auto mb-4 p-4 w-100">
								<div class="text-center">
									<h1 style="font-weight: 800; font-size: 50px; color:#2C2C2C !important"><t t-esc="oil_code"/> </h1>
									<h3 style="color:#2C2C2C !important">Add <b><t t-esc="oil_name"/></b> to the bottle and count the drops!</h3>
								</div>
							</div>
							
							<div class="d-flex w-100" style="max-width: 500px;">
								<div class="flex-fill me-2">
									<input type="number" id="dropCountInput" t-att-max="(value or {}).get(fragrance_name, 0)" min="0" placeholder="How many drops was that?" class="form-control form-control-lg"/>
								</div>
								<div style="width: 100px;">
									<input type="hidden" id="oilCode" t-att-value="oil_code"/>
									<input type="hidden" id="fragranceName" t-att-value="fragrance_name"/>
									<button id="submitDropCountBtn" type="button" class="btn btn-confirm btn-lg w-100 border-0 shadow font-weight-semibold" style="padding: 10px 0px; border-radius: 10px !important;">
										Confirm
									</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="fixed-bottom d-flex align-items-center justify-content-between p-3"
                    style="z-index: 1000;">
					<a t-attf-href="/perfume-journey/oil-detail?code={{oil_code}}&amp;category={{category}}" class="text-decoration-none d-flex align-items-center justify-content-center" style="background:#F9F2F0 !important; border-radius:15px;">
						<img src="/gm_web/static/src/img/prev.svg" alt="Back" class="img-fluid" style="width: 40px; height: 40px; object-fit: contain;"/>
					</a>
                    <img src="/gm_web/static/src/img/logo.png" class="img-fluid" style="width: 150px; margin-right:30px; margin-top:-20px;" alt="Logo"/>
                    <div style="width: 40px;"></div>
                </div>

				
				<div class="fixed-bottom p-3" style="z-index: 2000; pointer-events: none;">
					<div class="text-end me-2">
						<img t-att-src="'data:%s;base64,%s' % (avatar.get_image_mime('other'), avatar.decode_image(avatar.image))"
							alt="Avatar Image"
							class="img-fluid"
							style="height: 100px;" />
					</div>
				</div>


				<script>
					<![CDATA[
					document.addEventListener('DOMContentLoaded', function() {
						const urlParams = new URLSearchParams(window.location.search);
						const category = urlParams.get('category') || localStorage.getItem('selectedFragranceCategory') || 'citrus';
						
						// Store values
						localStorage.setItem('selectedFragranceCategory', category);
						
						// Handle submit button click
						const submitBtn = document.getElementById('submitDropCountBtn');
						if (submitBtn) {
							submitBtn.addEventListener('click', function() {
								const dropCountInput = document.getElementById('dropCountInput');
								const oilCode = document.getElementById('oilCode');
								const fragranceName = document.getElementById('fragranceName');
								
								const dropCount = parseInt(dropCountInput.value) || 0;
								const maxDrops = parseInt(dropCountInput.getAttribute('max')) || 0;
								
								// Validation
								if (dropCount <= 0) {
									alert('Please enter a valid number of drops');
									return;
								}
								
								if (dropCount > maxDrops) {
									alert(`Cannot add more than ${maxDrops} drops`);
									return;
								}
								
								// Navigate to oil-drop-added with parameters
								const params = new URLSearchParams({
									fragranceName: fragranceName.value,
									dropCountInput: dropCount,
									oilCode: oilCode.value
								});
								
								window.location.href = `/perfume-journey/add-oil?${params.toString()}`;
							});
						}
					});
					]]>
				</script>
			</t>
		</template>
	</data>
</odoo>
